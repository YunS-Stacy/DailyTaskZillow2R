{
    "collab_server" : "",
    "contents" : "  library('stringr')\n  library('xml2')\n  library('httr')\n  library('jsonlite')\n  library('rvest')\n  \n  html_1 <- read_html(\"https://www.zillow.com/homes/recently_sold/Philadelphia-PA/apartment_duplex_type/days_sort/\")\n  #Get Coords\n  lon_1 <- html_nodes(html_1, css='.zsg-photo-card-content > span:nth-child(2) > meta:nth-child(2)') %>%\n    html_attr('content')\n  lat_1 <- html_nodes(html_1, css='.zsg-photo-card-content > span:nth-child(2) > meta:nth-child(1)') %>%\n    html_attr('content')\n  #Get Prices\n  price_1 <- html_nodes(html_1, css='.zsg-photo-card-status') %>% \n    html_text() %>% str_replace(\"SOLD: \", \"\")\n  #Get Housing Info\n  infos_1 <- html_nodes(html_1, css='.zsg-photo-card-info') %>% \n    html_text()\n  ##price per sqft\n  unitprice_1 <- infos_1 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][1] %>%\n        str_replace(fixed(\"Price/sqft: \"), \"\")})\n  ##beds\n  beds_1 <- infos_1 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][2] %>%\n        str_replace(fixed(\" bds\"), \"\") %>%\n        str_replace(fixed(\" bd\"), \"\")\n    })\n  \n  ##baths\n  baths_1 <- infos_1 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][3] %>%\n        str_replace(fixed(\" ba\"), \"\")\n    })\n  #area\n  area_1 <- infos_1 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][4] %>%\n        str_replace(fixed(\" sqft\"), \"\")\n    })\n  \n  #Get sold date\n  solddate_1 <- html_nodes(html_1, css='.zsg-photo-card-notification') %>% \n    html_text() %>%\n    str_replace(\"Sold \",'') %>%\n    as.Date(format = '%m/%d/%Y')\n  \n  #Get address\n  address_1 <- html_nodes(html_1, css='.zsg-photo-card-address') %>% \n    html_text() %>%\n    str_replace(\", Philadelphia, PA\",'')\n  \n  latest_1 <- data.frame(address_1, solddate_1, price_1, unitprice_1, beds_1, baths_1, area_1, lon_1, lat_1, row.names = NULL)\n  names(latest_1)  <- c('address', 'solddate', 'price', 'unitprice', 'beds', 'baths', 'area', 'lon', 'lat')\n  \n  html_2 <- read_html(\"https://www.zillow.com/homes/recently_sold/Philadelphia-PA/apartment_duplex_type/days_sort/2_p\")\n  \n  \n  #Get Coords\n  lon_2 <- html_nodes(html_2, css='.zsg-photo-card-content > span:nth-child(2) > meta:nth-child(2)') %>%\n    html_attr('content')\n  lat_2 <- html_nodes(html_2, css='.zsg-photo-card-content > span:nth-child(2) > meta:nth-child(1)') %>%\n    html_attr('content')\n  #Get Prices\n  price_2 <- html_nodes(html_2, css='.zsg-photo-card-status') %>% \n    html_text() %>% str_replace(\"SOLD: \", \"\")\n  #Get Housing Info\n  infos_2 <- html_nodes(html_2, css='.zsg-photo-card-info') %>% \n    html_text()\n  ##price per sqft\n  unitprice_2 <- infos_2 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][1] %>%\n        str_replace(fixed(\"Price/sqft: \"), \"\")})\n  ##beds\n  beds_2 <- infos_2 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][2] %>%\n        str_replace(fixed(\" bds\"), \"\") %>%\n        str_replace(fixed(\" bd\"), \"\")\n    })\n  \n  ##baths\n  baths_2 <- infos_2 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][3] %>%\n        str_replace(fixed(\" ba\"), \"\")\n    })\n  #area\n  area_2 <- infos_2 %>% \n    sapply(function(x){\n      # unit price\n      strsplit(x,' · ')[[1]][4] %>%\n        str_replace(fixed(\" sqft\"), \"\")\n    })\n  \n  #Get sold date\n  solddate_2 <- html_nodes(html_2, css='.zsg-photo-card-notification') %>% \n    html_text() %>%\n    str_replace(\"Sold \",'') %>%\n    as.Date(format = '%m/%d/%Y')\n  \n  #Get address\n  address_2 <- html_nodes(html_2, css='.zsg-photo-card-address') %>% \n    html_text() %>%\n    str_replace(\", Philadelphia, PA\",'')\n  latest_2 <- data.frame(address_2, solddate_2, price_2, unitprice_2, beds_2, baths_2, area_2, lon_2, lat_2, row.names = NULL)\n  names(latest_2)  <- c('address', 'solddate', 'price', 'unitprice', 'beds', 'baths', 'area', 'lon', 'lat')\n  \n  datestart <- Sys.Date() - 30\n  \n  latest <- rbind(latest_1,latest_2)\n  \n  write.csv(latest, 'latest.csv')\n  latest <- read.csv('latest.csv')\n  latest <- latest[,-1]\n  today <- latest[as.Date(latest$solddate) >= datestart,] %>% na.omit() %>% toJSON()\n  \n  r <- PUT(body=today, url=\"https://smartselect-34c02.firebaseio.com/houseListing.json\")\n  test <- c(1, Sys.Date())\n  write.csv(test,'test.csv')\n  # r$status_code === 200 check success\n",
    "created" : 1492717186324.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "345768714",
    "id" : "E808AD26",
    "lastKnownWriteTime" : 1493290705,
    "last_content_update" : 1493290705777,
    "path" : "~/Documents/myapp/scheduledR/taskZillow.R",
    "project_path" : "taskZillow.R",
    "properties" : {
        "docOutlineVisible" : "0",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}